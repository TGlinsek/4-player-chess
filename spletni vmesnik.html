<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>4-player chess</title>
    <style>
        #plošča {
            border: 1px solid black;
            width: 50%;
            height: 50%;
            margin: auto; 
        }

        .polje:hover {
            border: 1px solid red;
        }
    </style>
</head>
<body>
    <table id="plošča"></table>

    <button id="gumb">Testni gumb</button>


    <script src="igra.js"></script>
    <script>
        var igra = new Igra();
        var štVrstic = 8;
        var štStolpcev = 8;

        var posodobiPloščo = function() {
            var vsaPolja = document.getElementsByClassName("polje");
            for (var i = 0; i < vsaPolja.length; i++) {
                vsaPolja[i].textContent = igra.plošča[parseInt(i / štStolpcev)][i % štStolpcev];
            }
        };

        // mouseDown se kliče le takrat ko pritisnemo dol, ne pa skos ko držimo gumb
        var vrniMouseDownCallBackFunkcijo = function(x, y) {
            return function(e) {
                igra.končnoPolje = null;  // resetiramo
                igra.začetnoPolje = (x, y);

                var novStrong = document.createElement("strong");
                novStrong.className = "slediMiški";
                var novImgTekst = document.createTextNode(igra.vrniPolje(x, y));
                novStrong.appendChild(novImgTekst);
                novStrong.style.position = "absolute";
                novStrong.style.top = String(parseInt(e.clientY) - 7) + "px";
                novStrong.style.left = String(parseInt(e.clientX) - 7) + "px";
                // novStrong.style.alignContent = "center";
                document.body.appendChild(novStrong);
            };
        };

        var vrniMouseUpCallBackFunkcijo = function(x, y) {
            return function(e) {
                igra.končnoPolje = (x, y);
                if (igra.začetnoPolje !== null) {
                    igra.premakni(igra.začetnoPolje[0], igra.začetnoPolje[1], igra.končnoPolje[0], igra.končnoPolje[1]);
                    posodobiPloščo();

                    var premikajočiElementi = document.getElementsByClassName("slediMiški");
                    for (var i = 0; i < premikajočiElementi.length; i++) {
                        premikajočiElementi[i].remove();
                    }
                }
                igra.začetnoPolje = null;
            };
        };

        var premikMiške = function(e) {
            var premikajočiElementi = document.getElementsByClassName("slediMiški");
            console.log(premikajočiElementi.length);
            if (premikajočiElementi.length > 1) {
                throw "Napaka!";
            }
            if (premikajočiElementi.length === 0) {
                return;
            }
            var premikajočiElement = premikajočiElementi[0];

            premikajočiElement.style.top = String(parseInt(e.clientY) - 7) + "px";
            premikajočiElement.style.left = String(parseInt(e.clientX) - 7) + "px";
        };

        document.body.addEventListener("mousemove", premikMiške);
    </script>
    <script>
        var plošča = document.getElementById("plošča");
        for (var i = 0; i < štVrstic; i++) {
            var novaVrsta = document.createElement("tr");
            // novaVrsta.style.border = "1px solid black";

            // plošča.appendChild(novaVrsta);
            for (var j = 0; j < štStolpcev; j++) {
                {
                    var novProstorček = document.createElement("td");
                    // novProstorček.textContent = "test";
                    novProstorček.style.border = "1px solid black";
                    
                    {
                        var novDiv = document.createElement("div");
                        novDiv.style.position = "relative";
                        novDiv.style.top = "0";
                        novDiv.style.left = "0";
                        novDiv.style.textAlign = "center";
                        novDiv.style.width = "100%";

                        {
                            var novStrong = document.createElement("strong");
                            novStrong.className = "polje";
                            novStrong.onmousedown = vrniMouseDownCallBackFunkcijo(j, i);
                            novStrong.onmouseup = vrniMouseUpCallBackFunkcijo(j, i);
                            var novImgTekst = document.createTextNode("K");
                            novStrong.appendChild(novImgTekst);
                            

                            /*
                            var novImg = document.createElement("img");
                            novImg.src = "";
                            novImg.alt = "Test";
                            novImg.width = "50";  // namest string lahk damo tut kr int
                            // 100 zapolni kar cel div, tk da tega ne rabimo spreminjat (nism zihr, a to tk deluje)
                            */
                        }
                        // novDiv.appendChild(novImg);
                        novDiv.appendChild(novStrong);
                    }
                    novProstorček.appendChild(novDiv);
                }

                novaVrsta.appendChild(novProstorček);
            }
            plošča.appendChild(novaVrsta);  // lahko pred ali za tem prejšnjim for loopom
        }  // window.sessionStorage
        var gumb = document.getElementById("gumb");
        gumb.addEventListener("click", posodobiPloščo);
        posodobiPloščo();
    </script>
</body>
</html>